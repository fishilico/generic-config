
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Network configuration &#8212; Generic Config</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kernel Network Console (netconsole module)" href="netconsole.html" />
    <link rel="prev" title="Linux NAT router" href="nat.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="netconsole.html" title="Kernel Network Console (netconsole module)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nat.html" title="Linux NAT router"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Some notes and tips&amp;tricks about system administration</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="network-configuration">
<h1>Network configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h1>
<p>This short document is a quick reference to some commands you would like to
know when you’re connecting to a network and asking “What’s the conf, here?”
If there is a kind of “automatic configuration” taking place, you may want to
know what information the network is giving you. In the other case, you need to
know how to set up a manual configuration by hand.</p>
<div class="section" id="ipv4-configuration">
<h2>IPv4 configuration<a class="headerlink" href="#ipv4-configuration" title="Permalink to this headline">¶</a></h2>
<p>Automatic IPv4 configuration is quite straightforward: run a DHCP client! For
example, to discover a DHCP server on <code class="docutils literal notranslate"><span class="pre">eth0</span></code> interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dhclient</span> <span class="n">eth0</span>
<span class="c1"># or</span>
<span class="n">dhcpcd</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>Static IPv4 configuration can be achieved thanks to <code class="docutils literal notranslate"><span class="pre">ip</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.42</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">eth0</span>
<span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="n">default</span> <span class="n">via</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">dev</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>This presupposes that you know what IP address your gateway uses. Without this
knowledge, you need to sniff and/or scan the network to find it.</p>
</div>
<div class="section" id="ipv6-configuration">
<h2>IPv6 configuration<a class="headerlink" href="#ipv6-configuration" title="Permalink to this headline">¶</a></h2>
<p>Automatic IPv6 configuration is more straightforward than IPv4: it is done by
the kernel and you have nothing to do! Sometimes you may want to ignore the
automatic configuration. This command disables it on <code class="docutils literal notranslate"><span class="pre">eth0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sysctl</span> <span class="o">-</span><span class="n">w</span> <span class="n">sys</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">ipv6</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">accept_ra</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Automatic configuration works because when a host sends a Router Solicitation
message (ICMPv6 type 133), the gateways answer with a Router Advertisement
(ICMPv6 type 134) containing information similar to DHCP. To send a RS by hand,
install <code class="docutils literal notranslate"><span class="pre">ndisc6</span></code> package and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rdisc6</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>Like with IPv4, static IPv6 can be configured with <code class="docutils literal notranslate"><span class="pre">ip</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">42</span><span class="o">/</span><span class="mi">64</span> <span class="n">dev</span> <span class="n">eth0</span>
<span class="n">ip</span> <span class="o">-</span><span class="mi">6</span> <span class="n">route</span> <span class="n">add</span> <span class="n">default</span> <span class="n">via</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">1</span> <span class="n">dev</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>However, unlike IPv4, there is a smart way to find the gateway: multicast. More
precisely, IPv6 defines <code class="docutils literal notranslate"><span class="pre">ff02::2</span></code> as being a multicast address for all
routers on a link (a Linux machine answers as a router when
<code class="docutils literal notranslate"><span class="pre">sys.net.ipv6.conf.forwarding</span></code> is 1). If your gateway answers to ping request,
you can run this command to get its IPv6 address:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping6</span> <span class="o">-</span><span class="n">c1</span> <span class="n">ff02</span><span class="p">::</span><span class="mi">2</span><span class="o">%</span><span class="n">eth0</span>
</pre></div>
</div>
<p>The result would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PING</span> <span class="n">ff02</span><span class="p">::</span><span class="mi">2</span><span class="o">%</span><span class="n">eth0</span><span class="p">(</span><span class="n">ff02</span><span class="p">::</span><span class="mi">2</span><span class="p">)</span> <span class="mi">56</span> <span class="n">data</span> <span class="nb">bytes</span>
<span class="mi">64</span> <span class="nb">bytes</span> <span class="kn">from</span> <span class="nn">fe80</span><span class="p">::</span><span class="mi">4242</span><span class="p">:</span><span class="mi">42</span><span class="n">ff</span><span class="p">:</span><span class="n">fe42</span><span class="p">:</span><span class="mi">4242</span><span class="p">:</span> <span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">64</span> <span class="n">time</span><span class="o">=</span><span class="mf">0.420</span> <span class="n">ms</span>
</pre></div>
</div>
<p>In such case, you may configure your default route with this link-local address
(in <code class="docutils literal notranslate"><span class="pre">fe80::/64</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">-</span><span class="mi">6</span> <span class="n">route</span> <span class="n">add</span> <span class="n">default</span> <span class="n">via</span> <span class="n">fe80</span><span class="p">::</span><span class="mi">4242</span><span class="p">:</span><span class="mi">42</span><span class="n">ff</span><span class="p">:</span><span class="n">fe42</span><span class="p">:</span><span class="mi">4242</span> <span class="n">dev</span> <span class="n">eth0</span>
</pre></div>
</div>
</div>
<div class="section" id="dns-configuration">
<h2>DNS configuration<a class="headerlink" href="#dns-configuration" title="Permalink to this headline">¶</a></h2>
<p>In automatic configurations, the IP addresses of the local DNS servers and the
search domains are found in DHCP headers and RA options. If you use a software
like NetworkManager or resolvconf or wicd, this information is directly written
in <code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>.</p>
<p>In manual configuration, edit this file with lines like these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># resolver1.opendns.com and resolver2.opendns.com</span>
<span class="n">nameserver</span> <span class="mf">208.67</span><span class="o">.</span><span class="mf">222.222</span>
<span class="n">nameserver</span> <span class="mf">208.67</span><span class="o">.</span><span class="mf">220.220</span>
<span class="n">domain</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">search</span> <span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div>
<div class="section" id="systemd-network-configuration">
<h2>Systemd network configuration<a class="headerlink" href="#systemd-network-configuration" title="Permalink to this headline">¶</a></h2>
<p>On a server which provides an ens42 wired connection with a static IP
configuration, it is possible to use systemd-networkd with the following
configuration in <code class="docutils literal notranslate"><span class="pre">/etc/systemd/network/wired.network</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Match</span><span class="p">]</span>
<span class="n">Name</span><span class="o">=</span><span class="n">ens42</span>

<span class="p">[</span><span class="n">Network</span><span class="p">]</span>
<span class="n">Address</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.42</span><span class="o">/</span><span class="mi">24</span>
<span class="n">Gateway</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">0.1</span>
</pre></div>
</div>
</div>
<div class="section" id="broadcast-ping">
<h2>Broadcast ping<a class="headerlink" href="#broadcast-ping" title="Permalink to this headline">¶</a></h2>
<p>To discover pingable hosts on your network, send an Echo Request (ping) to
every host. In IPv4 this broadcasts an ICMP type 8 message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping</span> <span class="o">-</span><span class="n">b</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.255</span> <span class="o">-</span><span class="n">I</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>In IPv6 this multicasts an ICMPv6 type 128 message to all nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ping6</span> <span class="n">ff02</span><span class="p">::</span><span class="mi">1</span><span class="o">%</span><span class="n">eth0</span>
</pre></div>
</div>
<p>After such command, you may list every link-layer addresses of your neighbors by
issuing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="n">neigh</span> <span class="n">show</span>
</pre></div>
</div>
</div>
<div class="section" id="link-layer-ping">
<h2>Link-layer ping<a class="headerlink" href="#link-layer-ping" title="Permalink to this headline">¶</a></h2>
<p>When the network don’t give your host an IP address, you need to find an unused
one. In IPv4 you can test whether an IP address is free or used by sending ARP
requests (what doesn’t require an IPv4 address to be configured, unlike
<code class="docutils literal notranslate"><span class="pre">ping</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arping</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">0.42</span> <span class="o">-</span><span class="n">I</span> <span class="n">eth0</span>
</pre></div>
</div>
<p>In IPv6, ARP requests are replaced with Neighbor Solicitation (ICMPv6 type 135
messages):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ndisc6</span> <span class="mi">2001</span><span class="p">:</span><span class="n">db8</span><span class="p">::</span><span class="mi">42</span> <span class="n">eth0</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Network configuration</a><ul>
<li><a class="reference internal" href="#ipv4-configuration">IPv4 configuration</a></li>
<li><a class="reference internal" href="#ipv6-configuration">IPv6 configuration</a></li>
<li><a class="reference internal" href="#dns-configuration">DNS configuration</a></li>
<li><a class="reference internal" href="#systemd-network-configuration">Systemd network configuration</a></li>
<li><a class="reference internal" href="#broadcast-ping">Broadcast ping</a></li>
<li><a class="reference internal" href="#link-layer-ping">Link-layer ping</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nat.html"
                        title="previous chapter">Linux NAT router</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="netconsole.html"
                        title="next chapter">Kernel Network Console (netconsole module)</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/sysadmin/netconfig.rst.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/fishilico/generic-config/blob/master/sysadmin/netconfig.rst"
           rel="nofollow">Show Source on GitHub
           <img src="../_static/GitHub-Mark-32px.png" style="width: 1.5em; border: none;" alt="" />
           </a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="netconsole.html" title="Kernel Network Console (netconsole module)"
             >next</a> |</li>
        <li class="right" >
          <a href="nat.html" title="Linux NAT router"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Some notes and tips&amp;tricks about system administration</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2019, Nicolas Iooss.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>