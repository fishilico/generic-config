
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sound Configuration &#8212; Generic Config</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nature.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="systemd configuration" href="systemd.html" />
    <link rel="prev" title="Some notes about my SELinux installation" href="selinux.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="systemd.html" title="systemd configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="selinux.html" title="Some notes about my SELinux installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Some notes and tips&amp;tricks about system administration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sound Configuration</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sound-configuration">
<h1>Sound Configuration<a class="headerlink" href="#sound-configuration" title="Permalink to this headline">¶</a></h1>
<p>Here are some notes about how I setup sound on my desktop systems.</p>
<section id="mpd-and-pulseaudio">
<h2>MPD and PulseAudio<a class="headerlink" href="#mpd-and-pulseaudio" title="Permalink to this headline">¶</a></h2>
<p>MPD (Music Player Daemon) is a system daemon which plays music from files,
playlists… It needs to interact with PulseAudio to get the sound out (using
ALSA) to enable multiplexing several audio output streams (like the ones which
are played by the Desktop Environment to signal important events to the user).</p>
<p>As it is discouraged to run PulseAudio as a system daemon, I use the standard
setup which spawns one PulseAudio server per logged user. However to allow
multiplexing MPD needs to use the same server as my user. Hence on my system
MPD is running with my user ID.</p>
<p>ArchLinux’ MPD wiki article give some tips to set up such configuration.
First, configure these two files:</p>
<p><code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/mpd-MYUSER.service</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">include</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">mpd</span><span class="o">.</span><span class="n">service</span>

<span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">Music</span> <span class="n">Player</span> <span class="n">Daemon</span> <span class="p">(</span><span class="n">running</span> <span class="k">as</span> <span class="n">MYUSER</span><span class="p">)</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">MYUSER</span>
<span class="n">PAMName</span><span class="o">=</span><span class="n">system</span><span class="o">-</span><span class="n">local</span><span class="o">-</span><span class="n">login</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">/etc/mpd.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">music_directory</span> <span class="s2">&quot;/home/public/music&quot;</span>
<span class="n">playlist_directory</span> <span class="s2">&quot;/var/lib/mpd/playlists&quot;</span>
<span class="n">db_file</span> <span class="s2">&quot;/var/lib/mpd/mpd.db&quot;</span>
<span class="n">pid_file</span> <span class="s2">&quot;/var/lib/mpd/mpd.pid&quot;</span>
<span class="n">state_file</span> <span class="s2">&quot;/var/lib/mpd/mpdstate&quot;</span>

<span class="n">user</span> <span class="s2">&quot;MYUSER&quot;</span>
<span class="n">audio_output</span> <span class="p">{</span>
    <span class="nb">type</span>            <span class="s2">&quot;pulse&quot;</span>
    <span class="n">name</span>            <span class="s2">&quot;MPD Pulse Output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then disable the system-wide MPD service and enable the new one:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>systemctl disable mpd
systemctl stop mpd
systemctl start mpd-MYUSER
systemctl <span class="nb">enable</span> mpd-MYUSER
</pre></div>
</div>
<p>Documentation:
<a class="reference external" href="https://wiki.archlinux.org/index.php/MPD/Tips_and_Tricks#MPD_and_PulseAudio">https://wiki.archlinux.org/index.php/MPD/Tips_and_Tricks#MPD_and_PulseAudio</a>
(This wiki also describe the setup with a local TCP socket)</p>
</section>
<section id="network">
<h2>Network<a class="headerlink" href="#network" title="Permalink to this headline">¶</a></h2>
<p>Streaming audio stream over the network is quite easy with PulseAudio. Let’s
suppose host <code class="docutils literal notranslate"><span class="pre">192.0.2.42</span></code> wants to send its audio output to a PulseAudio
server running on host <code class="docutils literal notranslate"><span class="pre">192.0.2.1</span></code>.</p>
<p>First setup the listener (<code class="docutils literal notranslate"><span class="pre">192.0.2.1</span></code>) to accept connections from the sender
(<code class="docutils literal notranslate"><span class="pre">192.0.2.42</span></code>). <code class="docutils literal notranslate"><span class="pre">/etc/pulse/default.pa</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="o">-</span><span class="n">module</span> <span class="n">module</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">protocol</span><span class="o">-</span><span class="n">tcp</span> <span class="n">auth</span><span class="o">-</span><span class="n">ip</span><span class="o">-</span><span class="n">acl</span><span class="o">=</span><span class="mf">127.0.0.1</span><span class="p">;</span><span class="mf">192.0.2.42</span>
</pre></div>
</div>
<p>Or here is the unsecure configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="o">-</span><span class="n">module</span> <span class="n">module</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="n">protocol</span><span class="o">-</span><span class="n">tcp</span> <span class="n">listen</span><span class="o">=</span><span class="mf">0.0.0.0</span> <span class="n">auth</span><span class="o">-</span><span class="n">anonymous</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>Then configure the sender to send its audio output. <code class="docutils literal notranslate"><span class="pre">/etc/pulse/default.pa</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">load</span><span class="o">-</span><span class="n">module</span> <span class="n">module</span><span class="o">-</span><span class="n">rtp</span><span class="o">-</span><span class="n">send</span> <span class="n">destination</span><span class="o">=</span><span class="mf">192.0.2.1</span> <span class="n">port</span><span class="o">=</span><span class="mi">16001</span>
</pre></div>
</div>
<p>To sync the configuration of PulseAudio with X11, there may be needed to run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pax11publish</span> <span class="o">-</span><span class="n">e</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Sound Configuration</a><ul>
<li><a class="reference internal" href="#mpd-and-pulseaudio">MPD and PulseAudio</a></li>
<li><a class="reference internal" href="#network">Network</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="selinux.html"
                        title="previous chapter">Some notes about my SELinux installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="systemd.html"
                        title="next chapter">systemd configuration</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/sysadmin/sound.rst.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/fishilico/generic-config/blob/master/sysadmin/sound.rst"
           rel="nofollow">Show Source on GitHub
           <img src="../_static/GitHub-Mark-32px.png" style="width: 1.5em; border: none;" alt="" />
           </a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="systemd.html" title="systemd configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="selinux.html" title="Some notes about my SELinux installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Some notes and tips&amp;tricks about system administration</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Sound Configuration</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2023, Nicolas Iooss.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>