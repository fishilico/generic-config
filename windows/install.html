
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installing Windows &#8212; Generic Config</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Keyboard shortcuts on Windows" href="key_shortcuts.html" />
    <link rel="prev" title="windows/hardening_script.bat" href="hardening_script.bat.raw.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="key_shortcuts.html" title="Keyboard shortcuts on Windows"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="hardening_script.bat.raw.html" title="windows/hardening_script.bat"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Windows system information</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installing Windows</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installing-windows">
<h1>Installing Windows<a class="headerlink" href="#installing-windows" title="Permalink to this headline">¶</a></h1>
<p>Here are some notes about installing Windows 10 Enterprise.</p>
<div class="section" id="base-installation-of-windows-10">
<h2>Base installation of Windows 10<a class="headerlink" href="#base-installation-of-windows-10" title="Permalink to this headline">¶</a></h2>
<p>In order to install Windows 10, a disc image (ISO file) can be downloaded from <a class="reference external" href="https://www.microsoft.com/en-us/software-download/windows10ISO">https://www.microsoft.com/en-us/software-download/windows10ISO</a>.</p>
<p>This would install Windows 10 Pro by default.
In order to set up another edition, all that is needed is to provide a matching license key.
Microsoft published a table describing what switches are available between Windows editions: <a class="reference external" href="https://docs.microsoft.com/en-us/windows/deployment/upgrade/windows-10-edition-upgrades">https://docs.microsoft.com/en-us/windows/deployment/upgrade/windows-10-edition-upgrades</a>.
For example, it is possible to switch from Windows 10 Pro to Windows 10 Enterprise using a KMS (Key Management Service) key.
The official Microsoft website documents such keys on <a class="reference external" href="https://docs.microsoft.com/en-us/windows-server/get-started/kmsclientkeys">https://docs.microsoft.com/en-us/windows-server/get-started/kmsclientkeys</a>.
On this website, Windows 10 Enterprise’s KMS key is <code class="docutils literal notranslate"><span class="pre">NPPR9-FWDCX-D2C8J-H872K-2YT43</span></code>.</p>
</div>
<div class="section" id="common-settings">
<h2>Common settings<a class="headerlink" href="#common-settings" title="Permalink to this headline">¶</a></h2>
<p>Some tools can be configured as soon as Windows is installed, in order to improve the experience of Windows.</p>
<p>When the system crashes, it is useful to have a meaningful memory dump file that can be analyzed with WinDbg.
In order to generate it, there are some settings:</p>
<ul class="simple">
<li><p>In “Advanced System Settings”, go to “Startup and Recovery” settings and choose option “Active Memory Dump” (available since Windows 10).
This enables generating a memory dump file (<code class="docutils literal notranslate"><span class="pre">C:\Windows\MEMORY.DMP</span></code>) with the Kernel memory and the Working Set of all processes (with their PEB, TEB and command line).
In the dialog box:</p>
<ul>
<li><p>Tick “Overwrite any existing file”, so that the file gets generated every time the system crashes.</p></li>
<li><p>Untick the automatic restart.</p></li>
</ul>
</li>
<li><p>In “Performance”, configure the size of the Page File to the size of the RAM, in order for the memory dump to fit in it.
Also ensure that at least 25 GB is free on the hard drive containing the Page File.</p></li>
</ul>
<p>To enhance the security of the system, several kernelmode hardening features can be enabled using Microsoft’s Driver Verifier, <code class="docutils literal notranslate"><span class="pre">verifier.exe</span></code>:</p>
<ul class="simple">
<li><p>“Special Pool”, in order to detect kernel heap overflows</p></li>
<li><p>“Force IRQL checking”, in order to detect IRQL issues in some drivers (this may detect real bugs!)</p></li>
<li><p>“Security checks”, in order to strengthen the security of the system</p></li>
</ul>
<p>When an application crash occurs, a minidump file is also generated in <code class="docutils literal notranslate"><span class="pre">C:\Windows\minidump\</span></code>.
This directory contains the 50 last generated minidump files (by default).</p>
</div>
<div class="section" id="enable-the-windows-subsystem-for-linux">
<h2>Enable the Windows Subsystem for Linux<a class="headerlink" href="#enable-the-windows-subsystem-for-linux" title="Permalink to this headline">¶</a></h2>
<p>To install WSL (Windows Subsystem for Linux), run this command as Administrator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">PowerShell</span> <span class="n">Enable</span><span class="o">-</span><span class="n">WindowsOptionalFeature</span> <span class="o">-</span><span class="n">Online</span> <span class="o">-</span><span class="n">FeatureName</span> <span class="n">Microsoft</span><span class="o">-</span><span class="n">Windows</span><span class="o">-</span><span class="n">Subsystem</span><span class="o">-</span><span class="n">Linux</span>

<span class="n">Path</span>          <span class="p">:</span>
<span class="n">Online</span>        <span class="p">:</span> <span class="kc">True</span>
<span class="n">RestartNeeded</span> <span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>After this command, the system should be rebooted.</p>
<p>In order to check whether WSL is installed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>C:\&gt; PowerShell Get-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux

FeatureName      : Microsoft-Windows-Subsystem-Linux
DisplayName      : Windows Subsystem for Linux
Description      : Provides services and environments for running native user-mode Linux shells
                   and tools on Windows.
RestartRequired  : Possible
State            : Enabled
CustomProperties :
                   ServerComponent\Description : Provides services and environments for running
                   native user-mode Linux shells and tools on Windows.
                   ServerComponent\DisplayName : Windows Subsystem for Linux
                   ServerComponent\Id : 1033
                   ServerComponent\Type : Feature
                   ServerComponent\UniqueName : Microsoft-Windows-Subsystem-Linux
                   ServerComponent\Deploys\Update\Name : Microsoft-Windows-Subsystem-Linux
</pre></div>
</div>
<p>In order to install Ubuntu, the following PowerShell commands can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">o</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">1804.</span><span class="n">appx</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">aka</span><span class="o">.</span><span class="n">ms</span><span class="o">/</span><span class="n">wsl</span><span class="o">-</span><span class="n">ubuntu</span><span class="o">-</span><span class="mi">1804</span>
<span class="c1"># Or, without using PowerShell aliases:</span>
<span class="c1"># Invoke-WebRequest -Uri https://aka.ms/wsl-ubuntu-1804 -OutFile Ubuntu-1804.appx -UseBasicParsing</span>
<span class="n">Rename</span><span class="o">-</span><span class="n">Item</span> <span class="n">Ubuntu</span><span class="o">-</span><span class="mf">1804.</span><span class="n">appx</span> <span class="n">Ubuntu</span><span class="o">-</span><span class="mf">1804.</span><span class="n">zip</span>
<span class="n">Expand</span><span class="o">-</span><span class="n">Archive</span> <span class="n">Ubuntu</span><span class="o">-</span><span class="mf">1804.</span><span class="n">zip</span> <span class="n">Ubuntu</span><span class="o">-</span><span class="mi">1804</span>
<span class="n">cd</span> <span class="n">Ubuntu</span><span class="o">-</span><span class="mi">1804</span>
<span class="o">.</span>\<span class="n">ubuntu1804</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>This last command spawns a shell inside a Ubuntu distribution which is using WSL.</p>
<p>Documentation about WSL:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a>
Generic installation guide</p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-on-server">https://docs.microsoft.com/en-us/windows/wsl/install-on-server</a>
Installation guide for servers</p></li>
<li><p><a class="reference external" href="https://docs.microsoft.com/en-gb/windows/wsl/release-notes">https://docs.microsoft.com/en-gb/windows/wsl/release-notes</a>
Release notes</p></li>
</ul>
</div>
<div class="section" id="software-to-install">
<h2>Software to install<a class="headerlink" href="#software-to-install" title="Permalink to this headline">¶</a></h2>
<div class="section" id="automatic-installation">
<h3>Automatic installation<a class="headerlink" href="#automatic-installation" title="Permalink to this headline">¶</a></h3>
<p>In order to ease the installation of software, a package manager such as
<a class="reference external" href="https://ninite.com/">Ninite</a> or <a class="reference external" href="https://chocolatey.org/">Chocolatey</a> can be
used (cf. <a class="reference external" href="https://chocolatey.org/docs/chocolatey-vs-ninite">https://chocolatey.org/docs/chocolatey-vs-ninite</a>).
Chocolatey’s website gives some installation commands
(<a class="reference external" href="https://chocolatey.org/docs/installation#install-with-cmdexe">https://chocolatey.org/docs/installation#install-with-cmdexe</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For cmd.exe</span>
<span class="o">@</span><span class="s2">&quot;%SystemRoot%\System32\WindowsPowerShell</span><span class="se">\v</span><span class="s2">1.0\powershell.exe&quot;</span> <span class="o">-</span><span class="n">NoProfile</span> <span class="o">-</span><span class="n">InputFormat</span> <span class="kc">None</span> <span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">Bypass</span> <span class="o">-</span><span class="n">Command</span> <span class="s2">&quot;iex ((New-Object System.Net.WebClient).DownloadString(&#39;https://chocolatey.org/install.ps1&#39;))&quot;</span>
<span class="n">SET</span> <span class="s2">&quot;PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey</span><span class="se">\b</span><span class="s2">in&quot;</span>

<span class="c1"># For PowerShell</span>
<span class="n">Set</span><span class="o">-</span><span class="n">ExecutionPolicy</span> <span class="n">Bypass</span> <span class="o">-</span><span class="n">Scope</span> <span class="n">Process</span> <span class="o">-</span><span class="n">Force</span><span class="p">;</span>
<span class="n">iex</span> <span class="p">((</span><span class="n">New</span><span class="o">-</span><span class="n">Object</span> <span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">WebClient</span><span class="p">)</span><span class="o">.</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Chocolatey adds itself to <code class="docutils literal notranslate"><span class="pre">%PATH%</span></code> environment variable, and this can be
verified in the registry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">Get</span><span class="o">-</span><span class="n">ItemProperty</span> <span class="o">-</span><span class="n">Path</span> <span class="s1">&#39;Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment&#39;</span> <span class="o">-</span><span class="n">Name</span> <span class="n">PATH</span>
<span class="c1"># It should ends with C:\ProgramData\chocolatey\bin;</span>

<span class="c1"># Or with cmd.exe:</span>
<span class="n">reg</span> <span class="n">query</span> <span class="s2">&quot;HKLM\System\CurrentControlSet\Control\Session Manager\Environment&quot;</span> <span class="o">/</span><span class="n">v</span> <span class="n">PATH</span>
</pre></div>
</div>
<p>Then, to install software:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">choco</span> <span class="n">install</span> <span class="n">notepadplusplus</span> <span class="n">notepadplusplus</span><span class="o">.</span><span class="n">commandline</span> <span class="n">vscode</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">windbg</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># Install Sysinternals tools, https://chocolatey.org/packages?q=sysinternals</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">procexp</span> <span class="n">procmon</span> <span class="n">autoruns</span> <span class="n">psexec</span> <span class="n">procdump</span> <span class="n">sigcheck</span> <span class="n">dbgview</span> <span class="n">winobj</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">adexplorer</span> <span class="n">accesschk</span> <span class="n">accessenum</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># MSys2 is installed in C:\tools\msys64</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">git</span> <span class="n">python3</span> <span class="n">msys2</span> <span class="o">-</span><span class="n">y</span>
<span class="c1"># Add &#39;PATH=&quot;$PATH:/c/Program Files/Git/cmd&quot;&#39; to C:/tools/msys64/home/IEUser/.bashrc</span>
<span class="c1"># Launch MSys with C:/tools/msys64/usr/bin/bash.exe</span>

<span class="c1"># Install Microsoft Visual C++ Runtime and .NET runtime</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">vcredist</span><span class="o">-</span><span class="nb">all</span> <span class="n">dotnet3</span><span class="o">.</span><span class="mi">5</span> <span class="n">dotnet4</span><span class="o">.</span><span class="mi">7</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># Install .NET framework and .NET Core SDK</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">dotnetfx</span> <span class="n">dotnetcore</span><span class="o">-</span><span class="n">sdk</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># Install Microsoft Baseline Security Analyzer</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">mbsa</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># Install other Desktop software</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">chromium</span> <span class="n">filezilla</span> <span class="n">firefox</span> <span class="n">kitty</span> <span class="n">vlc</span> <span class="n">winscp</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">ldapadmin</span> <span class="n">sql</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">management</span><span class="o">-</span><span class="n">studio</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">agentransack</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">windows</span><span class="o">-</span><span class="n">sdk</span><span class="o">-</span><span class="mf">10.0</span> <span class="n">windowsdriverkit10</span> <span class="n">visualstudio2019buildtools</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">dnspy</span> <span class="n">ilspy</span> <span class="n">wireshark</span> <span class="o">-</span><span class="n">y</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">processhacker</span> <span class="n">regshot</span> <span class="o">-</span><span class="n">y</span>
<span class="c1"># Install the CFF Explorer and Resource Hacker</span>
<span class="n">choco</span> <span class="n">install</span> <span class="n">explorersuite</span> <span class="n">reshack</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<p>These commands install the following software:</p>
<ul>
<li><p>Notepad++: <a class="reference external" href="https://notepad-plus-plus.org/">https://notepad-plus-plus.org/</a> (the sha1sums of the downloaded files can be verified)</p></li>
<li><p>Windows Development Kits, debugger (WinDbg…):</p>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.microsoft.com/en-us/windows/hardware/windows-driver-kit">https://developer.microsoft.com/en-us/windows/hardware/windows-driver-kit</a></p></li>
<li><p>Create a shortcut to <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files</span> <span class="pre">(x86)\Windows</span> <span class="pre">Kits\10\Debuggers\x64</span></code></p></li>
</ul>
</li>
<li><p>Some Sysinternals tools:</p>
<ul class="simple">
<li><p>Process Explorer <a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/processexplorer">https://technet.microsoft.com/en-us/sysinternals/processexplorer</a></p></li>
<li><p>Process Monitor <a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/processmonitor">https://technet.microsoft.com/en-us/sysinternals/processmonitor</a></p></li>
<li><p>DebugView <a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/debugview">https://technet.microsoft.com/en-us/sysinternals/debugview</a></p></li>
<li><p>WinObj <a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/winobj">https://technet.microsoft.com/en-us/sysinternals/winobj</a></p></li>
<li><p>AccessEnum <a class="reference external" href="https://technet.microsoft.com/en-us/sysinternals/accessenum">https://technet.microsoft.com/en-us/sysinternals/accessenum</a></p></li>
<li><p>etc.</p></li>
</ul>
</li>
<li><p>Git: <a class="reference external" href="https://git-scm.com/">https://git-scm.com/</a></p></li>
<li><p>Python: <a class="reference external" href="https://www.python.org/downloads/windows/">https://www.python.org/downloads/windows/</a></p></li>
<li><p>MSys2 environment: <a class="reference external" href="https://www.msys2.org/">https://www.msys2.org/</a>. Additional software like GCC
(to compile C programs) can be installed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">:</span>\<span class="n">tools</span>\<span class="n">msys64</span>\<span class="n">usr</span>\<span class="nb">bin</span>\<span class="n">bash</span><span class="o">.</span><span class="n">exe</span>
<span class="n">pacman</span> <span class="o">-</span><span class="n">Sy</span> <span class="n">base</span><span class="o">-</span><span class="n">devel</span> <span class="n">mingw</span><span class="o">-</span><span class="n">w64</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">toolchain</span>
</pre></div>
</div>
</li>
</ul>
<p>In the end: reboot! (Remember that we are talking about Windows…)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Powershell Restart-Computer&quot; may also work</span>
<span class="n">shutdown</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">t</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-10-s-packagemanagement">
<h3>Windows 10’s PackageManagement<a class="headerlink" href="#windows-10-s-packagemanagement" title="Permalink to this headline">¶</a></h3>
<p>PackageManagement (aka. <a class="reference external" href="https://github.com/oneget/oneget">OneGet</a>) is a package manager of package managers: it merges together <a class="reference external" href="https://www.nuget.org/">NuGet</a>, <a class="reference external" href="https://chocolatey.org/">Chocolatey</a>, etc.</p>
<p>It is installed by default on Windows 10 (cf. <a class="reference external" href="https://blogs.technet.microsoft.com/packagemanagement/2015/04/28/introducing-packagemanagement-in-windows-10/">https://blogs.technet.microsoft.com/packagemanagement/2015/04/28/introducing-packagemanagement-in-windows-10/</a>) and provides several commands:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PS C:\&gt; Get-Command -module PackageManagement | sort Noun, Verb
CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Cmdlet          Find-Package                                       1.0.0.1    PackageManagement
Cmdlet          Get-Package                                        1.0.0.1    PackageManagement
Cmdlet          Install-Package                                    1.0.0.1    PackageManagement
Cmdlet          Save-Package                                       1.0.0.1    PackageManagement
Cmdlet          Uninstall-Package                                  1.0.0.1    PackageManagement

Cmdlet          Find-PackageProvider                               1.0.0.1    PackageManagement
Cmdlet          Get-PackageProvider                                1.0.0.1    PackageManagement
Cmdlet          Import-PackageProvider                             1.0.0.1    PackageManagement
Cmdlet          Install-PackageProvider                            1.0.0.1    PackageManagement

Cmdlet          Get-PackageSource                                  1.0.0.1    PackageManagement
Cmdlet          Register-PackageSource                             1.0.0.1    PackageManagement
Cmdlet          Set-PackageSource                                  1.0.0.1    PackageManagement
Cmdlet          Unregister-PackageSource                           1.0.0.1    PackageManagement
</pre></div>
</div>
<p>Package managers can be enumerated using <code class="docutils literal notranslate"><span class="pre">Find-PackageProvider</span></code> and installed using <code class="docutils literal notranslate"><span class="pre">Get-PackageProvider</span></code>.
Here is an example of its use:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Chocolatey through PackageManagement</span>
Get-PackageProvider -Name chocolatey

<span class="c1"># Enumerate packages named with &quot;VLC&quot;</span>
Find-Package -Provider chocolatey -Name <span class="s2">&quot;*vlc*&quot;</span>

<span class="c1"># Install Notepad++</span>
Install-Package -Provider chocolatey notepadplusplus
</pre></div>
</div>
</div>
<div class="section" id="debloat-windows">
<h3>Debloat Windows<a class="headerlink" href="#debloat-windows" title="Permalink to this headline">¶</a></h3>
<p>Windows 10 comes with many features which are better disabled. Here are some
websites describing them:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/W4RH4WK/Debloat-Windows-10">https://github.com/W4RH4WK/Debloat-Windows-10</a></p></li>
<li><p><a class="reference external" href="https://www.01net.com/actualites/comme-windows-10-windows-7-et-8-embarquent-des-mouchards-911343.html">https://www.01net.com/actualites/comme-windows-10-windows-7-et-8-embarquent-des-mouchards-911343.html</a></p></li>
</ul>
<p>Here are commands that can be issued once Git has been installed, in a
PowerShell administrator console:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/W4RH4WK/Debloat-Windows-10
<span class="nb">cd</span> Debloat-Windows-10<span class="se">\s</span>cripts
Set-ExecutionPolicy Bypass -Scope Process -Force
.<span class="se">\b</span>lock-telemetry.ps1
.<span class="se">\d</span>isable-services.ps1
<span class="c1"># .\disable-windows-defender.ps1</span>
<span class="c1"># .\experimental_unfuckery.ps1 # Uncomment some apps there</span>
.<span class="se">\f</span>ix-privacy-settings.ps1
.<span class="se">\o</span>ptimize-user-interface.ps1
.<span class="se">\o</span>ptimize-windows-update.ps1
.<span class="se">\r</span>emove-default-apps.ps1
.<span class="se">\r</span>emove-onedrive.ps1
</pre></div>
</div>
</div>
</div>
<div class="section" id="hyper-v-configuration">
<h2>Hyper-V configuration<a class="headerlink" href="#hyper-v-configuration" title="Permalink to this headline">¶</a></h2>
<p>Hyper-V is quite straightforward to use but for network management.
In order to create an internal network which is NAT’ed to the external network, some PowerShell commands are documented on <a class="reference external" href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/setup-nat-network">https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/user-guide/setup-nat-network</a>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new virtual switch</span>
New-VMSwitch -SwitchName <span class="s1">&#39;Nat4HyperV&#39;</span> -SwitchType Internal

<span class="c1"># Retrieve the index of the new interface, with one of these two commands</span>
Get-NetAdapter
<span class="nv">$nat_ifindex</span> <span class="o">=</span> <span class="o">(</span>Get-NetAdapter -Name <span class="s1">&#39;vEthernet (Nat4HyperV)&#39;</span><span class="o">)</span>.ifIndex

<span class="c1"># Assign a static IP address to the host interface of the new switch</span>
New-NetIPAddress -IPAddress <span class="s1">&#39;10.0.0.1&#39;</span> -PrefixLength <span class="m">24</span> -InterfaceIndex <span class="nv">$nat_ifindex</span>

<span class="c1"># Create a new NAT (Network Address Translation)</span>
New-NetNat -Name <span class="s1">&#39;NatOfHyperV&#39;</span> -InternalIPInterfaceAddressPrefix <span class="s1">&#39;10.0.0.0/24&#39;</span>
</pre></div>
</div>
<p>It is then possible to associate the network adapter of Hyper-V virtual machines with internal network <code class="docutils literal notranslate"><span class="pre">Nat4HyperV</span></code>.</p>
</div>
<div class="section" id="activation-using-py-kms">
<h2>Activation using py-kms<a class="headerlink" href="#activation-using-py-kms" title="Permalink to this headline">¶</a></h2>
<p>In order to activate Windows in an offline environment, it is possible to install py-kms (<a class="reference external" href="https://github.com/SystemRage/py-kms">https://github.com/SystemRage/py-kms</a>) on a Debian Hyper-V virtual machine:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/SystemRage/py-kms
<span class="nb">cd</span> py-kms/py3-kms
python3 server.py -v DEBUG --sqlite
</pre></div>
</div>
<p>This will launch a KMS (Key Management Service) on TCP port 1688.
The following PowerShell commands configure a Windows system to use it, using SLMGR (the Software License Manager):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># In C:\Windows\system32</span>
<span class="nb">cd</span> %WINDIR%<span class="se">\s</span>ystem32

<span class="c1"># /upk for &quot;Uninstall Product Key&quot;</span>
cscript //Nologo slmgr.vbs /upk

<span class="c1"># /ipk for &quot;Install Product Key&quot;, for example for Windows 10 Enterprise</span>
cscript //Nologo slmgr.vbs /ipk NPPR9-FWDCX-D2C8J-H872K-2YT43

<span class="c1"># /skms to specify the KMS on IP address 192.0.2.42</span>
cscript //Nologo slmgr.vbs /skms <span class="m">192</span>.0.2.42:1688

<span class="c1"># /ato to prompt Windows to attempt online activation</span>
cscript //Nologo slmgr.vbs /ato

<span class="c1"># Display license information and detailed license information</span>
cscript //Nologo slmgr.vbs /dli
cscript //Nologo slmgr.vbs /dlv
</pre></div>
</div>
<p>This creates an entry in database <code class="docutils literal notranslate"><span class="pre">py-kms/py3-kms/clients.db</span></code> (table <code class="docutils literal notranslate"><span class="pre">clients</span></code>).</p>
<p>In order to launch py-kms as a systemd service, a service file can be created:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># cf. https://github.com/SystemRage/py-kms/issues/4</span>
cat &gt; /etc/systemd/system/py-kms.service <span class="s">&lt;&lt; EOF</span>
<span class="s">[Unit]</span>
<span class="s">Description=py3-kms</span>
<span class="s">After=network-online.target</span>
<span class="s">Wants=network-online.target</span>

<span class="s">[Service]</span>
<span class="s">Restart=always</span>
<span class="s">Type=simple</span>
<span class="s">ExecStart=/usr/bin/python3 /opt/py-kms/py3-kms/server.py -v DEBUG --sqlite</span>
<span class="s">WorkingDirectory=/opt/py-kms/py3-kms</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=multi-user.target</span>
<span class="s">EOF</span>

systemctl daemon-reload
systemctl <span class="nb">enable</span> py-kms.service
systemctl start py-kms.service
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installing Windows</a><ul>
<li><a class="reference internal" href="#base-installation-of-windows-10">Base installation of Windows 10</a></li>
<li><a class="reference internal" href="#common-settings">Common settings</a></li>
<li><a class="reference internal" href="#enable-the-windows-subsystem-for-linux">Enable the Windows Subsystem for Linux</a></li>
<li><a class="reference internal" href="#software-to-install">Software to install</a><ul>
<li><a class="reference internal" href="#automatic-installation">Automatic installation</a></li>
<li><a class="reference internal" href="#windows-10-s-packagemanagement">Windows 10’s PackageManagement</a></li>
<li><a class="reference internal" href="#debloat-windows">Debloat Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hyper-v-configuration">Hyper-V configuration</a></li>
<li><a class="reference internal" href="#activation-using-py-kms">Activation using py-kms</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="hardening_script.bat.raw.html"
                        title="previous chapter"><code class="docutils literal notranslate"><span class="pre">windows/hardening_script.bat</span></code></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="key_shortcuts.html"
                        title="next chapter">Keyboard shortcuts on Windows</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/windows/install.rst.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/fishilico/generic-config/blob/master/windows/install.rst"
           rel="nofollow">Show Source on GitHub
           <img src="../_static/GitHub-Mark-32px.png" style="width: 1.5em; border: none;" alt="" />
           </a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="key_shortcuts.html" title="Keyboard shortcuts on Windows"
             >next</a> |</li>
        <li class="right" >
          <a href="hardening_script.bat.raw.html" title="windows/hardening_script.bat"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Generic Config</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Windows system information</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Installing Windows</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2019, Nicolas Iooss.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>